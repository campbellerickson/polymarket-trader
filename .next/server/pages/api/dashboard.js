"use strict";(()=>{var t={};t.id=222,t.ids=[222],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:t=>{t.exports=require("crypto")},1309:t=>{t.exports=import("@supabase/supabase-js")},9926:t=>{t.exports=import("zod")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,r){return r in e?e[r]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,r)):"function"==typeof e&&"default"===r?e:void 0}}})},8110:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{config:()=>l,default:()=>u,routeModule:()=>c});var n=r(1802),s=r(7153),i=r(6249),o=r(4409),d=t([o]);o=(d.then?(await d)():d)[0];let u=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),c=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:o});a()}catch(t){a(t)}})},8159:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{O:()=>o});var n=r(9926),s=t([n]);let i=(n=(s.then?(await s)():s)[0]).z.object({KALSHI_API_ID:n.z.string().min(1),KALSHI_PRIVATE_KEY:n.z.string().min(1),VERCEL_AI_GATEWAY_KEY:n.z.string().min(1),SUPABASE_URL:n.z.string().url(),SUPABASE_KEY:n.z.string().min(1),CRON_SECRET:n.z.string().min(1),DAILY_BUDGET:n.z.string().transform(Number).default("100"),MIN_ODDS:n.z.string().transform(Number).default("0.90"),MAX_ODDS:n.z.string().transform(Number).default("0.98"),MAX_DAYS_TO_RESOLUTION:n.z.string().transform(Number).default("2"),MIN_LIQUIDITY:n.z.string().transform(Number).default("10000"),DRY_RUN:n.z.string().transform(t=>"true"===t).default("false"),INITIAL_BANKROLL:n.z.string().transform(Number).default("1000")}),o=function(){try{return i.parse(process.env)}catch(t){if(t instanceof n.z.ZodError){let e=t.errors.map(t=>t.path.join(".")).join(", ");throw Error(`Missing or invalid environment variables: ${e}`)}throw t}}();a()}catch(t){a(t)}})},8231:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{O:()=>o});var n=r(1309),s=r(8159),i=t([n,s]);[n,s]=i.then?(await i)():i;let o=(0,n.createClient)(s.O.SUPABASE_URL,s.O.SUPABASE_KEY);a()}catch(t){a(t)}})},3435:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{FC:()=>c,Pq:()=>d,dY:()=>l,lv:()=>o,mo:()=>i,sl:()=>u});var n=r(8231),s=t([n]);async function i(){let{data:t,error:e}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).eq("status","open").order("executed_at",{ascending:!1});if(e)throw e;return t}async function o(t=50){let{data:e,error:r}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).order("executed_at",{ascending:!1}).limit(t);if(r)throw r;return e}async function d(t,e){let{data:r,error:a}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).gte("executed_at",t.toISOString()).lte("executed_at",e.toISOString()).order("executed_at",{ascending:!1});if(a)throw a;return r}async function u(){return(await i()).map(t=>({trade:t,current_odds:t.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}))}async function l(){let{data:t}=await n.O.from("performance_metrics").select("bankroll").order("date",{ascending:!1}).limit(1).single();return t?.bankroll||Number(process.env.INITIAL_BANKROLL)||1e3}async function c(){return Number(process.env.INITIAL_BANKROLL)||1e3}n=(s.then?(await s)():s)[0],a()}catch(t){a(t)}})},913:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{YK:()=>d});var n=r(8159),s=r(4770),i=r.n(s),o=t([n]);async function d(t){let e=`/markets/${t}`,r=await fetch(`https://api.elections.kalshi.com/trade-api/v2${e}`,{method:"GET",headers:function(t,e,r){let a=Date.now().toString(),s=function(t,e,r){let a=Date.now().toString(),s=`${a}GET${e}${r||""}`,o=n.O.KALSHI_PRIVATE_KEY.replace(/\\n/g,"\n");return i().createSign("RSA-SHA256").update(s).sign(o,"base64")}("GET",e,void 0);return{"KALSHI-ACCESS-KEY":n.O.KALSHI_API_ID,"KALSHI-ACCESS-TIMESTAMP":a,"KALSHI-ACCESS-SIGNATURE":s,"Content-Type":"application/json"}}(0,e)});if(!r.ok){let t=await r.text();throw Error(`Failed to fetch market: ${r.status} ${r.statusText} - ${t}`)}let a=await r.json(),s=a.market||a,o=parseFloat(s.yes_bid||s.yesBid||s.yes_odds||0)/100,d=parseFloat(s.no_bid||s.noBid||s.no_odds||100-parseFloat(s.yes_bid||s.yesBid||s.yes_odds||0))/100;return{market_id:s.ticker||s.market_id||s.id,question:s.title||s.question||s.subtitle,end_date:new Date(s.expiration_time||s.expirationTime||s.end_date),yes_odds:o,no_odds:d,liquidity:parseFloat(s.liquidity||s.open_interest||0),volume_24h:parseFloat(s.volume||s.volume_24h||0),resolved:"closed"===s.status||"resolved"===s.status,outcome:s.result?"yes"===s.result?"YES":"NO":void 0,final_odds:s.result_price?parseFloat(s.result_price)/100:void 0,resolved_at:s.settlement_time?new Date(s.settlement_time):void 0}}n=(o.then?(await o)():o)[0],a()}catch(t){a(t)}})},1258:(t,e,r)=>{function a(t){let e=t.filter(t=>"open"!==t.status);return 0===e.length?0:e.filter(t=>"won"===t.status).length/e.length}function n(t){return t.reduce((t,e)=>t+(e.pnl||0),0)}r.d(e,{tt:()=>a,yj:()=>n})},4409:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{default:()=>d});var n=r(3435),s=r(913),i=r(1258),o=t([n,s]);async function d(t,e){if("GET"!==t.method)return e.status(405).json({error:"Method not allowed"});try{let t=await (0,n.lv)(1e3),r=t.filter(t=>"open"!==t.status),a=await (0,n.dY)(),o=await (0,n.FC)(),d=(0,i.yj)(r),u=(0,i.tt)(r),l=await (0,n.mo)(),c=await (0,n.sl)(),_=await Promise.all(c.map(async t=>{try{let e=await (0,s.YK)(t.trade.contract.market_id),r="YES"===t.trade.side?e.yes_odds:e.no_odds,a=t.trade.contracts_purchased*r-t.trade.position_size,n=a/t.trade.position_size*100;return{...t,current_odds:r,unrealized_pnl:a,unrealized_pnl_pct:n}}catch(e){return{...t,current_odds:t.trade.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}}})),p=new Date,m=new Date(p.getFullYear(),p.getMonth(),1),f=(await (0,n.Pq)(m,p)).filter(t=>"open"!==t.status),A=(0,i.yj)(f),y=await (0,n.FC)(),h=new Date(p.getFullYear(),0,1),S=(await (0,n.Pq)(h,p)).filter(t=>"open"!==t.status),g=(0,i.yj)(S),E=t.slice(0,20);return e.status(200).json({currentBankroll:a,initialBankroll:o,totalPnL:d,totalReturn:o>0?d/o*100:0,winRate:u,totalTrades:t.length,openTrades:l.length,mtdPnL:A,mtdReturn:y>0?A/y*100:0,ytdPnL:g,ytdReturn:o>0?g/o*100:0,recentTrades:E,openPositions:_})}catch(t){return console.error("Dashboard API error:",t),e.status(500).json({error:t.message})}}[n,s]=o.then?(await o)():o,a()}catch(t){a(t)}})},7153:(t,e)=>{var r;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return r}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(t,e,r)=>{t.exports=r(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var r=e(e.s=8110);module.exports=r})();