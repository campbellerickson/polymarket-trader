"use strict";exports.id=947,exports.ids=[947],exports.modules={6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8159:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{O:()=>s});var a=r(9926),n=e([a]);let o=(a=(n.then?(await n)():n)[0]).z.object({KALSHI_API_ID:a.z.string().min(1),KALSHI_PRIVATE_KEY:a.z.string().min(1),VERCEL_AI_GATEWAY_KEY:a.z.string().min(1).optional(),AI_GATEWAY_API_KEY:a.z.string().min(1).optional(),VERCEL_OIDC_TOKEN:a.z.string().min(1).optional(),SUPABASE_URL:a.z.string().url(),SUPABASE_KEY:a.z.string().min(1).optional(),SUPABASE_SERVICE_ROLE_KEY:a.z.string().min(1).optional(),CRON_SECRET:a.z.string().min(1),DAILY_BUDGET:a.z.string().transform(Number).default("100"),MIN_ODDS:a.z.string().transform(Number).default("0.85"),MAX_ODDS:a.z.string().transform(Number).default("0.98"),MAX_DAYS_TO_RESOLUTION:a.z.string().transform(Number).default("2"),MIN_LIQUIDITY:a.z.string().transform(Number).default("2000"),DRY_RUN:a.z.string().transform(e=>"true"===e).default("false"),INITIAL_BANKROLL:a.z.string().transform(Number).default("1000")}),s=function(){try{let e=o.parse(process.env),t=e.SUPABASE_KEY||e.SUPABASE_SERVICE_ROLE_KEY;if(!t)throw Error("Missing SUPABASE_KEY (or SUPABASE_SERVICE_ROLE_KEY)");let r=e.VERCEL_AI_GATEWAY_KEY||e.AI_GATEWAY_API_KEY||e.VERCEL_OIDC_TOKEN;if(!r)throw Error("Missing VERCEL_AI_GATEWAY_KEY (or AI_GATEWAY_API_KEY / VERCEL_OIDC_TOKEN)");return{...e,SUPABASE_KEY:t,VERCEL_AI_GATEWAY_KEY:r}}catch(e){if(e instanceof a.z.ZodError){let t=e.errors.map(e=>e.path.join(".")).join(", ");throw Error(`Missing or invalid environment variables: ${t}`)}throw e}}();i()}catch(e){i(e)}})},913:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{DZ:()=>l,Et:()=>g,TN:()=>d,YI:()=>m,YK:()=>p,Z9:()=>_,fetchMarkets:()=>E,mR:()=>c,s1:()=>f,up:()=>A});var a=r(8159),n=r(358),o=e([a]);function s(){let e;let t=(((e=(a.O.KALSHI_PRIVATE_KEY??"").trim()).startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))&&(e=e.slice(1,-1).trim()),e=(e=e.replace(/\\n/g,"\n")).replace(/\r\n/g,"\n"));if(!t.includes("BEGIN RSA PRIVATE KEY")&&!t.includes("BEGIN PRIVATE KEY")&&!t.includes("BEGIN ENCRYPTED PRIVATE KEY"))throw Error("Invalid private key format: missing PEM BEGIN marker");return new n.Configuration({apiKey:a.O.KALSHI_API_ID,privateKeyPem:t,basePath:"https://api.elections.kalshi.com/trade-api/v2"})}a=(o.then?(await o)():o)[0];let h=null,y=null,I=null;function l(){return y||(y=new n.MarketApi(s())),y}function d(e){return"number"==typeof e.yes_bid?Math.round(e.yes_bid):"number"==typeof e.yes_bid_dollars?Math.round(100*e.yes_bid_dollars):"number"==typeof e.yesBid?Math.round(e.yesBid):"number"==typeof e.yesBidDollars?Math.round(100*e.yesBidDollars):"number"==typeof e.yes_odds&&e.yes_odds>0&&e.yes_odds<=1?Math.round(100*e.yes_odds):null}function u(e){return new Promise(t=>setTimeout(t,e))}async function c(e){let t=[],r=null,i=0,a=e?.rateLimitMs??500,n=e?.maxPages??100;console.log(`ðŸ” Fetching all active markets from Kalshi (with pagination, ${a}ms rate limit)...`);let o=l();do{if(++i>n){console.warn(`âš ï¸ Reached max pages limit (${n}). Stopping pagination.`);break}try{let e=await o.getMarkets(100,r||void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"open",void 0,void 0),n=e.data.markets||[];if(t.push(...n),r=e.data.cursor||null,console.log(`   Page ${i}: Fetched ${n.length} markets (total: ${t.length})`),!r||0===n.length)break;r&&n.length>0&&await u(a)}catch(e){if(e.response?.status===429){let t=e.response.headers["retry-after"],r=t?1e3*parseInt(t):5e3;console.warn(`âš ï¸ Rate limited (429). Waiting ${r}ms before retry...`),await u(r);continue}if(e.message?.includes("429")||e.message?.includes("rate")){console.warn(`âš ï¸ Rate limit error. Waiting ${2*a}ms before retry...`),await u(2*a);continue}throw console.error(`Error fetching markets page ${i}:`,e.message),e}}while(r);return console.log(`âœ… Fetched ${t.length} total markets across ${i} pages`),t.map(e=>{let t;let r=d(e);try{t=new Date(e.expiration_time||e.expirationTime||e.end_date),isNaN(t.getTime())&&(console.warn(`Invalid expiration date for market ${e.ticker}: ${e.expiration_time}`),t=new Date(Date.now()+6048e5))}catch(e){t=new Date(Date.now()+6048e5)}return{market_id:e.ticker||e.market_id||e.id,question:e.title||e.question||e.subtitle||"N/A",end_date:t,yes_odds:null!==r?r/100:0,no_odds:null!==r?(100-r)/100:0,liquidity:0,volume_24h:parseFloat(e.volume||e.volume_24h||0),resolved:"closed"===e.status||"resolved"===e.status,category:e.category||void 0,outcome:e.result?"yes"===e.result?"YES":"NO":void 0,final_odds:e.result_price?parseFloat(e.result_price)/100:void 0,resolved_at:e.settlement_time?new Date(e.settlement_time):void 0}})}async function _(e){let t=l();try{let r,i;let a=await t.getMarketOrderbook(e),n=a.data.orderbook||a.data,o=n.true||[],s=n.false||[],l=o.length>0&&Array.isArray(o[0])&&o[0].length>=2?{price:o[0][0]/100,size:o[0][1]}:{price:0,size:0},d=s.length>0&&Array.isArray(s[0])&&s[0].length>=2?{price:s[0][0]/100,size:s[0][1]}:{price:0,size:0},u=100*l.price;return u>=85?(r=l.size,i="YES"):u<=15?(r=d.size,i="NO"):(r=l.size,i="YES"),{orderbook:{market_id:e,bestYesBid:l.price,bestYesAsk:l.price,bestNoBid:d.price,bestNoAsk:d.price},liquidity:r,side:i}}catch(r){let e=r.response?.data?.error?.message||r.message||"Unknown error",t=r.response?.status||500;throw Error(`Failed to fetch orderbook: ${t} - ${e}`)}}function m(e){let t=new Date,r=e.getTime()-t.getTime();return Math.max(0,r/864e5)}async function E(){return c()}async function p(e){let t=l();try{let r=await t.getMarket(e),i=r.data.market||r.data,a=d(i);return{market_id:i.ticker||i.market_id||i.id,question:i.title||i.question||i.subtitle,end_date:new Date(i.expiration_time||i.expirationTime||i.end_date),yes_odds:null!==a?a/100:0,no_odds:null!==a?(100-a)/100:0,liquidity:parseFloat(i.liquidity||i.open_interest||0),volume_24h:parseFloat(i.volume||i.volume_24h||0),resolved:"closed"===i.status||"resolved"===i.status,category:i.category||void 0,outcome:i.result?"yes"===i.result?"YES":"NO":void 0,final_odds:i.result_price?parseFloat(i.result_price)/100:void 0,resolved_at:i.settlement_time?new Date(i.settlement_time):void 0}}catch(r){let e=r.response?.data?.error?.message||r.message||"Unknown error",t=r.response?.status||500;throw Error(`Failed to fetch market: ${t} - ${e}`)}}async function A(e){let{orderbook:t}=await _(e);return t}async function g(){let e=(h||(h=new n.PortfolioApi(s())),h);try{return((await e.getBalance()).data.balance||0)/100}catch(r){let e=r.response?.data?.error?.message||r.message||"Unknown error",t=r.response?.status||500;throw Error(`Failed to fetch balance: ${t} ${e}`)}}async function f(e){if("true"===process.env.DRY_RUN)return console.log("\uD83E\uDDEA DRY RUN: Would place order:",e),{order_id:"dry-run-order",status:"resting"};let t=(I||(I=new n.OrdersApi(s())),I),r="YES"===e.side||"SELL_YES"===e.side?"yes":"no",i=e.side.startsWith("SELL")?"sell":"buy",a=Math.max(1,Math.min(99,Math.floor(100*e.price)));try{let n={ticker:e.market,side:r,action:i,count:Math.floor(e.amount),type:"limit"};"yes"===r?n.yes_price=a:n.no_price=a;let o=await t.createOrder(n);return o.data.order||o.data}catch(r){let e=r.response?.data?.error?.message||r.message||"Unknown error",t=r.response?.status||500;throw Error(`Failed to place order: ${t} ${e}`)}}i()}catch(e){i(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};