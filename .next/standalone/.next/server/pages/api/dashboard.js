"use strict";(()=>{var t={};t.id=222,t.ids=[222],t.modules={358:t=>{t.exports=require("kalshi-typescript")},145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1309:t=>{t.exports=import("@supabase/supabase-js")},9926:t=>{t.exports=import("zod")},8110:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.r(e),a.d(e,{config:()=>_,default:()=>d,routeModule:()=>c});var r=a(1802),n=a(7153),i=a(6249),o=a(4409),l=t([o]);o=(l.then?(await l)():l)[0];let d=(0,i.l)(o,"default"),_=(0,i.l)(o,"config"),c=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:o});s()}catch(t){s(t)}})},3288:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.d(e,{B3:()=>o,ce:()=>_,eH:()=>l,zF:()=>d});var r=a(8231),n=a(3435),i=t([r,n]);async function o(t,e){let a=new Date(t,e-1,1),s=new Date(t,e,0,23,59,59),r=String(e).padStart(2,"0");console.log(`ðŸ“Š Generating monthly analysis for ${t}-${r}...`);let i=(await (0,n.Pq)(a,s)).filter(t=>"open"!==t.status&&null!==t.pnl);if(0===i.length)return{month_year:a,total_trades:0,total_invested:0,total_pnl:0,win_rate:0,avg_roi:0,market_type_analysis:{},series_analysis:{},top_market_types:[],top_series_ids:[],worst_market_types:[],worst_series_ids:[],insights:"No resolved trades for this month."};let o={},l={};for(let t of i){let e=function(t,e){if(e)return e;let a=t.toLowerCase();return a.includes("election")||a.includes("vote")||a.includes("candidate")?"Elections/Politics":a.includes("sport")||a.includes("game")||a.includes("match")||a.includes("nfl")||a.includes("nba")||a.includes("mlb")||a.includes("football")||a.includes("basketball")||a.includes("baseball")?"Sports":a.includes("earnings")||a.includes("stock")||a.includes("market")?"Finance/Earnings":a.includes("data")||a.includes("release")||a.includes("report")?"Data Releases":a.includes("deadline")||a.includes("date")||a.includes("by")?"Time-based":a.includes("approval")||a.includes("approve")||a.includes("regulatory")?"Regulatory/Approval":"Other"}(t.contract?.question||"",t.contract?.category),a=function(t){let e=t.split("-");return e.length>=2?e.slice(0,2).join("-"):e[0]||t}(t.contract?.market_id||"");o[e]||(o[e]={trades:0,total_invested:0,total_pnl:0,wins:0,losses:0,win_rate:0,avg_roi:0}),l[a]||(l[a]={trades:0,total_invested:0,total_pnl:0,wins:0,losses:0,win_rate:0,avg_roi:0});let s=t.position_size||0,r=t.pnl||0;o[e].trades++,o[e].total_invested+=s,o[e].total_pnl+=r,"won"===t.status?o[e].wins++:o[e].losses++,l[a].trades++,l[a].total_invested+=s,l[a].total_pnl+=r,"won"===t.status?l[a].wins++:l[a].losses++}let d=t=>{t.win_rate=t.trades>0?t.wins/t.trades:0,t.avg_roi=t.total_invested>0?t.total_pnl/t.total_invested*100:0};Object.values(o).forEach(d),Object.values(l).forEach(d);let _=i.reduce((t,e)=>t+(e.position_size||0),0),c=i.reduce((t,e)=>t+(e.pnl||0),0),u=i.filter(t=>"won"===t.status).length,p=i.length>0?u/i.length:0,y=Object.entries(o).map(([t,e])=>({type:t,roi:e.avg_roi,stats:e})).filter(t=>t.stats.trades>=3),m=Object.entries(l).map(([t,e])=>({series_id:t,roi:e.avg_roi,stats:e})).filter(t=>t.stats.trades>=2),w=y.sort((t,e)=>e.roi-t.roi).slice(0,5).map(t=>({type:t.type,roi:t.roi})),g=y.sort((t,e)=>t.roi-e.roi).slice(0,3).map(t=>({type:t.type,roi:t.roi})),f=m.sort((t,e)=>e.roi-t.roi).slice(0,5).map(t=>({series_id:t.series_id,roi:t.roi})),h=m.sort((t,e)=>t.roi-e.roi).slice(0,3).map(t=>({series_id:t.series_id,roi:t.roi})),v=function(t,e,a,s){let r=[];a.length>0&&r.push(`Best performing market types: ${a.map(t=>`${t.type} (${t.roi.toFixed(1)}% ROI)`).join(", ")}`),s.length>0&&r.push(`Underperforming market types: ${s.map(t=>`${t.type} (${t.roi.toFixed(1)}% ROI)`).join(", ")}`);let n=t.Sports;n&&n.trades>=5&&r.push(`Sports markets: ${n.trades} trades, ${(100*n.win_rate).toFixed(1)}% win rate, ${n.avg_roi.toFixed(1)}% ROI`);let i=t["Elections/Politics"];return(i&&i.trades>=5&&r.push(`Political markets: ${i.trades} trades, ${(100*i.win_rate).toFixed(1)}% win rate, ${i.avg_roi.toFixed(1)}% ROI`),0===r.length)?"Insufficient data for meaningful insights this month.":r.join(". ")+"."}(o,0,w,g);return{month_year:a,total_trades:i.length,total_invested:_,total_pnl:c,win_rate:p,avg_roi:_>0?c/_*100:0,market_type_analysis:o,series_analysis:l,top_market_types:w,top_series_ids:f,worst_market_types:g,worst_series_ids:h,insights:v}}async function l(t){let e=t.month_year.getFullYear(),a=String(t.month_year.getMonth()+1).padStart(2,"0"),s=`${e}-${a}-01`,{error:n}=await r.O.from("monthly_analysis").upsert({month_year:s,total_trades:t.total_trades,total_invested:t.total_invested,total_pnl:t.total_pnl,win_rate:t.win_rate,avg_roi:t.avg_roi,market_type_analysis:t.market_type_analysis,series_analysis:t.series_analysis,top_market_types:t.top_market_types,top_series_ids:t.top_series_ids,worst_market_types:t.worst_market_types,worst_series_ids:t.worst_series_ids,insights:t.insights,updated_at:new Date().toISOString()},{onConflict:"month_year"});if(n)throw Error(`Failed to save monthly analysis: ${n.message}`);console.log(`âœ… Saved monthly analysis for ${s}`)}async function d(t,e){let a=String(e).padStart(2,"0"),s=`${t}-${a}-01`,{data:n,error:i}=await r.O.from("monthly_analysis").select("*").eq("month_year",s).single();if(i){if("PGRST116"===i.code)return null;throw i}return n?{month_year:new Date(n.month_year),total_trades:n.total_trades,total_invested:parseFloat(n.total_invested?.toString()||"0"),total_pnl:parseFloat(n.total_pnl?.toString()||"0"),win_rate:parseFloat(n.win_rate?.toString()||"0"),avg_roi:parseFloat(n.avg_roi?.toString()||"0"),market_type_analysis:n.market_type_analysis||{},series_analysis:n.series_analysis||{},top_market_types:n.top_market_types||[],top_series_ids:n.top_series_ids||[],worst_market_types:n.worst_market_types||[],worst_series_ids:n.worst_series_ids||[],insights:n.insights||""}:null}async function _(){let{data:t,error:e}=await r.O.from("monthly_analysis").select("*").order("month_year",{ascending:!1});if(e)throw e;return t?t.map(t=>({month_year:new Date(t.month_year),total_trades:t.total_trades,total_invested:parseFloat(t.total_invested?.toString()||"0"),total_pnl:parseFloat(t.total_pnl?.toString()||"0"),win_rate:parseFloat(t.win_rate?.toString()||"0"),avg_roi:parseFloat(t.avg_roi?.toString()||"0"),market_type_analysis:t.market_type_analysis||{},series_analysis:t.series_analysis||{},top_market_types:t.top_market_types||[],top_series_ids:t.top_series_ids||[],worst_market_types:t.worst_market_types||[],worst_series_ids:t.worst_series_ids||[],insights:t.insights||""})):[]}[r,n]=i.then?(await i)():i,s()}catch(t){s(t)}})},8231:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.d(e,{O:()=>o});var r=a(1309),n=a(8159),i=t([r,n]);[r,n]=i.then?(await i)():i;let o=(0,r.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_KEY);s()}catch(t){s(t)}})},3435:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.d(e,{$r:()=>l,FC:()=>y,Jg:()=>c,Of:()=>w,Pq:()=>d,Xb:()=>_,Xx:()=>m,dY:()=>p,fT:()=>g,lv:()=>o,mo:()=>i,sl:()=>u,zC:()=>f});var r=a(8231),n=t([r]);async function i(){let{data:t,error:e}=await r.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).eq("status","open").order("executed_at",{ascending:!1});if(e)throw e;return t}async function o(t=50){let{data:e,error:a}=await r.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).order("executed_at",{ascending:!1}).limit(t);if(a)throw a;return e}async function l(){let t=new Date;t.setHours(0,0,0,0);let{data:e,error:a}=await r.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).gte("executed_at",t.toISOString()).order("executed_at",{ascending:!1});if(a)throw a;return e}async function d(t,e){let{data:a,error:s}=await r.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).gte("executed_at",t.toISOString()).lte("executed_at",e.toISOString()).order("executed_at",{ascending:!1});if(s)throw s;return a}async function _(t){let{data:e,error:a}=await r.O.from("trades").insert({...t,status:"open",executed_at:new Date().toISOString()}).select(`
      *,
      contract:contracts(*)
    `).single();if(a)throw a;return e}async function c(t,e){let{data:a,error:s}=await r.O.from("trades").update(e).eq("id",t).select(`
      *,
      contract:contracts(*)
    `).single();if(s)throw s;return a}async function u(){return(await i()).map(t=>({trade:t,current_odds:t.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}))}async function p(){let{data:t}=await r.O.from("performance_metrics").select("bankroll").order("date",{ascending:!1}).limit(1).single();return t?.bankroll||Number(process.env.INITIAL_BANKROLL)||1e3}async function y(){return Number(process.env.INITIAL_BANKROLL)||1e3}async function m(t){let{data:e}=await r.O.from("performance_metrics").select("bankroll").lte("date",t.toISOString()).order("date",{ascending:!1}).limit(1).single();return e?.bankroll||Number(process.env.INITIAL_BANKROLL)||1e3}async function w(){let t=await p(),e=(await u()).reduce((t,e)=>t+e.trade.position_size,0);return t-e}async function g(){let{data:t,error:e}=await r.O.from("notification_preferences").select("*").eq("user_id","default").single();if(e&&"PGRST116"!==e.code)throw e;return t||{enabled:!1}}async function f(t){let e=new Date(Date.now()-36e5*t),{data:a,error:s}=await r.O.from("stop_loss_events").select(`
      *,
      trade:trades(
        *,
        contract:contracts(*)
      )
    `).gte("executed_at",e.toISOString()).order("executed_at",{ascending:!1});if(s)throw s;return a}r=(n.then?(await n)():n)[0],s()}catch(t){s(t)}})},1258:(t,e,a)=>{function s(t){let e=t.filter(t=>"open"!==t.status);return 0===e.length?0:e.filter(t=>"won"===t.status).length/e.length}function r(t){return t.reduce((t,e)=>t+(e.pnl||0),0)}a.d(e,{tt:()=>s,yj:()=>r})},4409:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.r(e),a.d(e,{default:()=>d});var r=a(3435),n=a(913),i=a(1258),o=a(3288),l=t([r,n,o]);async function d(t,e){if("GET"!==t.method)return e.status(405).json({error:"Method not allowed"});try{let t=await (0,r.lv)(1e3),a=t.filter(t=>"open"!==t.status),s=await (0,r.dY)(),l=await (0,r.FC)(),d=(0,i.yj)(a),_=(0,i.tt)(a),c=await (0,r.mo)(),u=await (0,r.sl)(),p=await Promise.all(u.map(async t=>{try{let e=await (0,n.YK)(t.trade.contract.market_id),a="YES"===t.trade.side?e.yes_odds:e.no_odds,s=t.trade.contracts_purchased*a-t.trade.position_size,r=s/t.trade.position_size*100;return{...t,current_odds:a,unrealized_pnl:s,unrealized_pnl_pct:r}}catch(e){return{...t,current_odds:t.trade.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}}})),y=new Date,m=new Date(y.getFullYear(),y.getMonth(),1),w=(await (0,r.Pq)(m,y)).filter(t=>"open"!==t.status),g=(0,i.yj)(w),f=await (0,r.FC)(),h=new Date(y.getFullYear(),0,1),v=(await (0,r.Pq)(h,y)).filter(t=>"open"!==t.status),k=(0,i.yj)(v),S=t.slice(0,20),O=(await (0,o.ce)()).slice(0,3),b=new Date().getMonth()+1,x=new Date().getFullYear(),F=await (0,o.zF)(1===b?x-1:x,1===b?12:b-1);return e.status(200).json({currentBankroll:s,initialBankroll:l,totalPnL:d,totalReturn:l>0?d/l*100:0,winRate:_,totalTrades:t.length,openTrades:c.length,mtdPnL:g,mtdReturn:f>0?g/f*100:0,ytdPnL:k,ytdReturn:l>0?k/l*100:0,recentTrades:S,openPositions:p,monthlyAnalyses:O,lastMonthAnalysis:F})}catch(t){return console.error("Dashboard API error:",t),e.status(500).json({error:t.message})}}[r,n,o]=l.then?(await l)():l,s()}catch(t){s(t)}})}};var e=require("../../webpack-api-runtime.js");e.C(t);var a=t=>e(e.s=t),s=e.X(0,[947],()=>a(8110));module.exports=s})();